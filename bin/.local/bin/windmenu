#!/bin/sh

xwin_ls()
{
    wmctrl -xl | awk '
# $3 != "emacs.Emacs" {
{
    $2 = ""; $4 = "";
    split($3, class, ".")
    $3 = class[2]
    print "w  " $0
}
'
}

ebuf_ls()
{
    emacsclient --eval '
(mapconcat
 (apply-partially (quote concat) "e  ")
 (cl-delete-if
  (apply-partially (quote string-prefix-p) " ")
  (mapcar (quote buffer-name) (buffer-list)))
 "\n")
' | xargs echo -e
}

all_ls() {
    xwin_ls
    ebuf_ls
}

selected="$(all_ls | rofi -p 'Window' -dmenu -i -no-custom)"
[ -z "${selected}" ] && exit 1

case "${selected}" in
    e*)
        echo "${selected}" | cut -c4- | xargs -I'{}' emacsclient -c --eval '(switch-to-buffer "{}")'
        ;;
    w*)
        echo "${selected}" | cut -d' ' -f3 | xargs wmctrl -i -a
        ;;
    *)
        exit 1
esac
